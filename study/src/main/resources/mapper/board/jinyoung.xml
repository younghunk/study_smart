<?xml version="1.0" encoding="UTF-8"?>

<!-- mapper 기본설정 -->
<!DOCTYPE  mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="jinyoung">
	
	
	<!-- 총 게시물 건수 (totalCount) -->
	<select id="getTotalCount" parameterType="HashMap" resultType="int">
		SELECT count(*)
		FROM Board.tbl_board
		WHERE status = 1
	</select>
	
	
	<!-- 전체 게시글 조회 -->
	<select id="boardList" parameterType="HashMap" resultType="com.example.demo.board.jinyoung.vo.JYBoardVO">
		SELECT *
		FROM Board.tbl_board
		WHERE status = 1
		<choose>
			<!-- 제목으로 검색할 때 -->
			<when test="searchType == 'subject' and searchWord != ''">
				and lower(subject) like concat('%', lower(#{searchWord}), '%')
			</when>
			<!-- 내용으로 검색할 때 -->
			<when test="searchType == 'content' and searchWord != ''">
				and lower(content) like concat('%', lower(#{searchWord}), '%')
			</when>
			<!-- 제목 또는 내용 -->
			<when test="searchType == 'subject_content' and searchWord != ''">
				and (lower(subject) like concat('%', lower(#{searchWord}), '%') OR lower(content) like concat('%' , lower(#{searchWord}) , '%'))
			</when>
			<!-- 아이디로 검색 -->
			<when test="searchType == 'userid' and searchWord != ''">
				and lower(userid) like concat('%', lower(#{searchWord}), '%')
			</when>
			<otherwise></otherwise>
		</choose>
		ORDER BY seq desc
	</select>
	
	
	<!-- 글 1개 조회 -->
	<select id="getView" parameterType="String" resultType="com.example.demo.board.jinyoung.vo.JYBoardVO">
		SELECT *
		FROM Board.tbl_board
		WHERE seq = #{seq}
	</select>
	
	
	<!-- 조회수 1 증가 -->
	<update id="increase_readCount" parameterType="String">
		UPDATE Board.tbl_board set readCount = readCount + 1
		WHERE seq = #{seq}
	</update>
	
	
	<!-- 글쓰기 요청 완료 -->
	<insert id="addEnd" parameterType="HashMap">
		INSERT into Board.tbl_board (userid, subject, content)
		VALUES (#{userid}, #{subject}, #{content})
	</insert>
	
	
	<!-- 글삭제 요청 완료 -->
	<update id="del" parameterType="String">
		UPDATE Board.tbl_board SET status = 0
		WHERE seq = ${seq}
	</update>
	
	
	<!-- 글수정 요청 완료 -->
	<update id="editEnd" parameterType="HashMap">
		UPDATE Board.tbl_board SET subject = #{subject}, content = #{content}
		WHERE seq = #{seq}
	</update>
	
	
	<!-- 제목 수정 -->
	<update id="subjectChange" parameterType="HashMap">
		UPDATE Board.tbl_board SET subject = #{subject}
		WHERE seq = #{seq}
	</update>
	
	
	
	
</mapper>